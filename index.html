<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <script type="application/javascript">
      document.body.style.backgroundColor = '#8a2be2';

      const container = document.createElement('div')
      container.style.maxWidth = '700px';
      container.style.margin = '0 auto';
      container.style.maxHeight='1000px';
      container.style.height='650px';
      container.style.border = '1px solid #ccc';
      container.style.borderRadius = '8px';
      container.style.overflow = 'hidden';
      container.style.backgroundColor = '#fff';
      container.style.padding = '10px';
      document.body.append(container)
    
      const ul = document.createElement('ul')
      ul.style.overflowY = 'scroll';
      ul.style.maxHeight = '500px';
      ul.style.scrollbarColor = 'rgba(0, 0, 0, 0.5) rgba(0, 0, 0, 0)';
      ul.style.scrollbarWidth = 'thin';

      document.body.append(ul)

      const t = document.createElement('textarea')
      t.style.width = 'calc(100% - 20px)';
      t.style.padding = '10px';
      t.style.boxSizing = 'border-box';
      t.style.margin = '10px 0';
      t.style.border = '1px solid #ccc';
      t.style.borderRadius = '4px';

      const b = document.createElement('button')
      b.style.width = 'calc(100% - 20px)';
      b.style.padding = '10px';
      b.style.boxSizing = 'border-box';
      b.style.margin = '0';
      b.style.backgroundColor = '#4CAF50';
      b.style.color = 'white';
      b.style.border = 'none';
      b.style.borderRadius = '4px';
      b.style.cursor = 'pointer';
      b.append('SEND')
      
      container.append(ul, t, b);

      //function to get the messages
      const getMessages = async () => {
        const response = await fetch('https://chat.tiburoncin.lat/messages')
        const messages = await response.json()
        
        messages.reverse().forEach((message) => {
          const li = document.createElement('p')

          if (message.username === 'Sebastian') {
            li.style.textAlign = 'right';
            li.style.backgroundColor = '#90EE90';
            li.style.color = '#000';
            li.textContent = `${message.message}`;
            li.style.margin = '5px 0';
            li.style.padding = '8px';
            li.style.borderRadius = '8px';
            li.style.maxWidth = '80%';
            li.style.wordWrap = 'break-word';
            
            const messageLength = message.message.length;
            const minWidth = 150; 
            const calculatedWidth = Math.max(minWidth, messageLength * 8);
            
            li.style.width = `${calculatedWidth}px`;
            li.style.marginLeft='100px';

            ul.appendChild(li);
          } else {
            li.style.textAlign = 'left';
            li.style.backgroundColor = '#FFDB58';
            li.style.color = '#000';
            li.textContent = `${message.username}: ${message.message}`;
            li.style.margin = '5px 0';
            li.style.padding = '8px';
            li.style.borderRadius = '8px';
            li.style.maxWidth = '80%';
            li.style.wordWrap = 'break-word';

            const messageLength = message.message.length;
            const minWidth = 150; 
            const calculatedWidth = Math.max(minWidth, messageLength * 8);

            li.style.width = `${calculatedWidth}px`;

            ul.appendChild(li);
          }
        
        })
        ul.scrollTop = ul.scrollHeight;
      }

      //DataBase Connection
      const postMessage = async () => {
        console.log(t.value)
        const body = {
          username: 'Sebastian',
          message: t.value,
        }
        const response = await fetch('https://chat.tiburoncin.lat/messages',
        {
          method: 'POST',
          body: JSON.stringify(body)
        })
        ul.innerHTML = ""
        getMessages()
      }

      //show message
      b.addEventListener('click', postMessage)

      //get messages
      getMessages()
    </script>
  </body>
</html>